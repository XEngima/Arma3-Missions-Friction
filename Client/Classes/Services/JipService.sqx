/*
 * Name:	JipService
 * Date:	2018-12-25
 * Version: 1.0
 * Author:  Engima
 *
 * Description:
 * A service that starts up a JIP player.
 */

using Sqx.Services;
using Mission.Client.Statics;
using Mission.Common;
using Mission.Communication;

namespace Mission.Client
{
	public class JipService : Service
	{
		public constructor()
		{
			call _base.Constructor;
		};
		
		protected override method Run()
		{
			private ["_missionMarkersInfo" as MissionMarkersInfo];
			private ["_briefingService" as MissionBriefingService, "_missionBriefing" as MissionBriefing];
			
			waitUntil { player == player };
			
			// Set markers
			
			_missionMarkersInfo = call PublicVariableHandler.GetMissionMarkersInfo;
			if (!isNull _missionMarkersInfo) then {
				[_missionMarkersInfo] call ClientObjects.MapMarkerHandler.UpdateMarkers;
			};
			
			// Set briefing
			
			_missionBriefing = call PublicVariableHandler.GetMissionBriefing;
			if (!isNull _missionBriefing) then {
				_briefingService = [_missionBriefing, ClientObjects.BriefingHandler, ClientObjects.TaskHandler, true] new MissionBriefingService;
				call _briefingService.RunAsync;
			};
			
			// Set camera
			
		    sleep 1;
			call ClientObjects.CameraHandler.SetDeathCamera;
			sleep 0.5;
	  		cutText ["","BLACK IN", 1];
		    
		    call _base.Run;
		};
	};
};
