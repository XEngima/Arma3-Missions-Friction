/*
 * Name:	ClientEventReciever
 * Date:	2019-01-31
 * Version: 1.0
 * Author:  Engima
 *
 * Description:
 * Static class that handles all custom events sent from other machines.
 *
 * Remarks:
 * The idea here is to avoid being specific about what is supposed to happen on the target machine. The name of each 
 * method should start with "On" to reflect an event that "happens" on the machine firing it. E.g. do not name a method like 
 * "ThrowPlayerInTeamKillPrison". Instead name it after the reason, so better use "OnPlayerKilled" with killer and
 * victim as parameters. This way
 * the server do not care about what happens on the client, it simply reports what happens on the server. And also,
 * the client may want to do more than one thing with this event. E.g. lowering the killers rating. This way you do not 
 * couple the server and client together, so that the server can focus only on server stuff and the client only on client
 * stuff.
 *
 * Do not perform logic in this class - (or at least not advanced logic). Instead route the event message action to
 * the class or classes meant to handle the logic needed for each event message respectively.
 */

using Mission.Common;
using Mission.Common.Statics;
using Mission.Client;

namespace Mission.Client.Statics
{
	public class ClientEventReciever
	{
		// Called when the mission engine on the server starts.
		public static method OnMissionStart()
		{
		
		};
	
		// Called each time a second passes in the mission.
		// _missionTimeRemaining (Scalar): The remaining time until the mission ends in seconds.
		public static method OnMissionTimeTick("_missionTimeRemaining" as Scalar)
		{
			hint ("Mission ends in " + (str _missionTimeRemaining) + " minutes.");
		};
		
		public static method OnMissionSetup("_missionMarkersInfo" as MissionMarkersInfo)
		{
			[_missionMarkersInfo] call ClientObjects.MapMarkerHandler.UpdateMarkers;
		};
		
		public static method OnInsertGroup("_group" as Group, "_position" as Array)
		{
			private ["_teleporter" as TeleportService];
			
			if (playerSide == side _group) then
			{
				_teleporter = [_position] new TeleportService;
				call _teleporter.RunAsync;
				
				{
					if (local _x && _x != player) then {
						_x setPos _position;
					};
				} foreach units _group;
			};
		};
		
		public static method OnMissionEnded("_missionResult" as MissionResult)
		{
			private ["_teleporter" as TeleportService];
			
			// Show mission result
			
			player sideChat ("west: " + str _missionResult.ResultInfoWest.Score);
			player sideChat ("east: " + str _missionResult.ResultInfoEast.Score);
			
			// Teleport to base
			
			private _baseMarkerName = [playerSide, BaseMarker.Respawn] call CommonObjects.BaseMarkersConfig.GetMarkerName;
			
			_teleporter = [getMarkerPos _baseMarkerName] new TeleportService;
			call _teleporter.RunAsync;
		};
		
		public static method OnMissionBriefing("_missionBriefing" as MissionBriefing)
		{
			private ["_primaryObjective" as MissionObjective, "_secondaryObjective" as MissionObjective];
			
			_primaryObjective = [playerSide] call _missionBriefing.GetPrimaryObjective;
			_secondaryObjective = [playerSide] call _missionBriefing.GetSecondaryObjective;
			
			if (!isNull _primaryObjective) then {
				[_primaryObjective, ObjectivePrio.Primary] call ClientObjects.TaskHandler.CreateTask;
			};
			
			if (!isNull _secondaryObjective) then {
				[_secondaryObjective, ObjectivePrio.Secondary] call ClientObjects.TaskHandler.CreateTask;
			};
		};
	};
};
